# Railway Deployment Guide for VYB Backend

## 🚀 Quick Deploy

### Option 1: Automated Script
```bash
npm run deploy:railway
```

### Option 2: Manual Steps
1. **Login to Railway**
   ```bash
   railway login
   ```

2. **Initialize Project**
   ```bash
   railway init
   ```

3. **Deploy**
   ```bash
   railway up
   ```

## 🔧 Environment Setup

### Required Environment Variables

Set these in your Railway dashboard:

#### Database & Cache
```env
DATABASE_URL=postgresql://...  # Auto-generated by Railway
REDIS_URL=redis://...          # Auto-generated by Railway
```

#### Authentication
```env
JWT_SECRET=your-super-secret-jwt-key-32-chars-min
MAGIC_LINK_SECRET=your-magic-link-secret-key
```

#### Email Service
```env
EMAIL_FROM=noreply@vyb.app
RESEND_API_KEY=re_your-resend-api-key
```

#### External APIs
```env
OPENAI_API_KEY=sk-your-openai-api-key
NEWSAPI_KEY=your-newsapi-key
X_BEARER_TOKEN=your-twitter-bearer-token
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
```

#### CORS & Security
```env
CORS_ORIGIN=https://your-frontend-domain.com
RATE_LIMIT_IP_PER_MINUTE=120
RATE_LIMIT_USER_SWIPES_PER_MINUTE=30
```

#### Ranking Algorithm Weights
```env
RANKING_W1_LIQUIDITY=0.28
RANKING_W2_VOLUME=0.22
RANKING_W3_DRIFT=0.16
RANKING_W4_SOCIAL=0.24
RANKING_W5_TIME=0.10
```

#### Feature Flags
```env
ENABLE_INSIGHTS=true
ENABLE_REALTIME=true
ENABLE_OTEL=false
```

## 📊 Adding Services

### PostgreSQL Database
1. Go to Railway dashboard
2. Click "Add Service" → "Database" → "PostgreSQL"
3. Railway will automatically set `DATABASE_URL`

### Redis Cache
1. Go to Railway dashboard
2. Click "Add Service" → "Database" → "Redis"
3. Railway will automatically set `REDIS_URL`

## 🗄️ Database Setup

After deployment, run these commands:

```bash
# Run migrations
railway run npm run db:migrate:deploy

# Seed with sample data
railway run npm run db:seed
```

## 🔍 Monitoring

### Health Checks
- **Basic**: `https://your-app.railway.app/healthz`
- **API Docs**: `https://your-app.railway.app/docs`
- **OpenAPI**: `https://your-app.railway.app/docs-json`

### Logs
```bash
railway logs
```

### Status
```bash
railway status
```

## 🌐 Custom Domain

1. Go to Railway dashboard
2. Select your service
3. Go to "Settings" → "Domains"
4. Add your custom domain
5. Update `CORS_ORIGIN` environment variable

## 🔄 CI/CD Setup

### GitHub Integration
1. Connect your GitHub repository to Railway
2. Railway will auto-deploy on push to main branch
3. Set up environment variables in Railway dashboard

### Manual Deployment
```bash
# Deploy from local
railway up

# Deploy specific service
railway up --service your-service-name
```

## 🛠️ Troubleshooting

### Common Issues

#### Database Connection
```bash
# Check database URL
railway variables get DATABASE_URL

# Test connection
railway run npm run db:studio
```

#### Redis Connection
```bash
# Check Redis URL
railway variables get REDIS_URL

# Test connection
railway run node -e "console.log(process.env.REDIS_URL)"
```

#### Build Failures
```bash
# Check build logs
railway logs --build

# Check deployment logs
railway logs --deploy
```

### Environment Variables
```bash
# List all variables
railway variables

# Set a variable
railway variables set KEY=value

# Get a variable
railway variables get KEY
```

## 📈 Scaling

### Horizontal Scaling
- Railway automatically handles load balancing
- Add more instances in Railway dashboard

### Vertical Scaling
- Upgrade your Railway plan for more resources
- Monitor usage in Railway dashboard

## 🔐 Security

### Environment Variables
- Never commit `.env` files
- Use Railway's secure environment variable storage
- Rotate secrets regularly

### CORS Configuration
- Set `CORS_ORIGIN` to your frontend domain
- Use HTTPS in production

### Rate Limiting
- Configure rate limits based on your needs
- Monitor rate limit usage

## 📱 Frontend Integration

After deployment, update your Lovable frontend:

```env
VITE_API_URL=https://your-app.railway.app
VITE_WS_URL=https://your-app.railway.app
```

## 🎯 Production Checklist

- [ ] All environment variables set
- [ ] PostgreSQL and Redis services added
- [ ] Database migrations run
- [ ] Health check passing
- [ ] CORS origin configured
- [ ] Custom domain set up (optional)
- [ ] Monitoring configured
- [ ] Frontend updated with API URL

## 📞 Support

- **Railway Docs**: https://docs.railway.app
- **Railway Dashboard**: https://railway.app/dashboard
- **VYB API Docs**: `https://your-app.railway.app/docs`
